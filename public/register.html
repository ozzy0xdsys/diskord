<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Diskord â€¢ Register</title>
  <link rel="stylesheet" href="/static/style.css"/>
</head>
<body>
  <div class="container">
    <div class="card" style="padding:18px; max-width:520px;">
      <div class="brand" style="margin-bottom:10px;">
        <div class="logo" aria-hidden="true"></div>
        <div>
          <strong>Diskord</strong><br/>
          <small>Create an account</small>
        </div>
      </div>

      <h1 style="margin-top:8px;">Register</h1>
      <small class="muted">Pick a username and password.</small>

      <div class="notice hidden" id="regErr" style="margin-top:10px;"></div>

      <label>Username</label>
      <input id="rUser" autocomplete="username" placeholder="pick a name"/>

      <label>Password</label>
      <input id="rPass" type="password" autocomplete="new-password" placeholder="min 8 characters"/>

      <div style="margin-top:12px; display:flex; gap:10px; align-items:center;">
        <button id="regBtn">Create account</button>
        <a class="muted" href="/login" style="text-decoration:none;">Already have an account? Log in</a>
      </div>

      <div style="margin-top:14px;">
        <small class="muted"><a href="/privacy">Privacy policy</a></small>
      </div>
    </div>
  </div>

<script>
const api = async (path, body) => {
  const r = await fetch(path, {
    method:"POST",
    headers:{ "Content-Type":"application/json" },
    body: JSON.stringify(body || {})
  });
  const j = await r.json().catch(()=>({}));
  if(!r.ok) throw new Error(j.error || "Request failed");
  return j;
};
function setErr(el, msg){
  el.textContent = msg;
  el.classList.remove("hidden");
  el.classList.toggle("error", true);
}
function clearErr(el){
  el.classList.add("hidden");
  el.textContent = "";
}
async function go(token){
  localStorage.setItem("diskord_token", token);
  location.href = "/app";
}
document.getElementById("regBtn").onclick = async () => {
  const err = document.getElementById("regErr");
  clearErr(err);
  try{
    const username = document.getElementById("rUser").value;
    const password = document.getElementById("rPass").value;
    const { token } = await api("/api/register", { username, password });
    await go(token);
  }catch(e){ setErr(err, e.message); }
};
if(localStorage.getItem("diskord_token")) location.href="/app";
</script>
</body>
</html>
